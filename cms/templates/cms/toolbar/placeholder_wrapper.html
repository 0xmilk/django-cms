{% load i18n sekizai_tags cms_tags %}
{% addtoblock "js" %}
<script type="text/javascript">
CMS.$(document).ready(function () {
	new CMS.Placeholder('#cms_placeholder-{{ instance.pk }}', {
		'type': 'plugin',
		'page_id': '{{ instance.page.id }}', // todo this should be removed / not required
		'placeholder_id': '{{ instance.placeholder.id }}',
		'plugin_type': '{{ instance.plugin_type }}',
		'plugin_id': '{{ instance.pk }}',
		'plugin_language': '{{ instance.language }}',
		'plugin_children' : [ // empty = false
			{% for class, name in child_plugin_classes %}
			{'type':'{{ class  }}', 'title':'{{ name }}'}{% if not forloop.last %},{% endif %}
			{% endfor %}
		],
		'plugin_order': null,
		'plugin_breadcrumb': [],
		'urls': {
			'add_plugin': '{{ instance.placeholder.get_add_url }}',
			'edit_plugin': '{{ instance.placeholder.get_changelist_url }}',
			'remove_plugin': '{{ instance.placeholder.get_remove_url }}'
		}
	});
});
</script>
{% endaddtoblock %}

{% if not instance.parent %}<div id="cms_placeholder-{{ instance.pk }}" class="cms_placeholder cms_light">{{ rendered_content }}</div>{% endif %}
<div id="cms_dragholder-{{ instance.pk }}" class="cms_reset cms_light cms_dragholder cms_dragholder-draggable">
	<div class="cms_dragmenu"></div>
	<div class="cms_dragmenu-dropdown">
		<span>{% trans "Settings" %}</span>
		<a rel="dialogue" data-text="Are you sure you want to copy this plugin?" href="#">Copy</a>
		<a rel="sideframe" href="{{ instance.placeholder.get_remove_url }}{{ instance.pk }}">Delete</a>
		{% for class, name in child_plugin_classes %}
		{% if forloop.first %}<span>{% trans "Add Plugin" %}</span>{% endif %}
		<a rel="add_plugin"{% if forloop.last %} class="last"{% endif %} href="{{ class }}">{{ name }}</a>
		{% endfor %}
	</div>
	<div class="cms_dragitem"><strong>{{ instance.plugin_type }}</strong> {{ instance.placeholder.slot }}</div>
	{% if instance.get_plugin_class.allow_children and instance.plugion_children %}
		{% for plugin in instance.plugin_children %}
			{% render_plugin plugin %}
		{% endfor %}
	{% endif %}
</div>

